# Test runner for service  category
#

# Service we try to fondle - if not running, we pick another.
_service="snmp"

function service_create() {
	print(">>> Starting service tests")
	_pid = $(service ${_service} get pid)
	maybe_barf(_pid == none, "+service#1", "The " + _service + " service is not running on this machine")
	@$(service ${_service} stop)
	maybe_barf(_success, "+service#2", "Unable to stop " + _service + " service")
	_pid = $(service ${_service} get pid)
	maybe_barf(_pid == none, "+service#3", "pid of " + _service + " still set when stopped")
	@$(service ${_service} start)
	maybe_barf(_success, "+service#4", "Unable to start " + _service + " service")
	_pid = $(service ${_service} get pid)
	maybe_barf(_pid != none, "+service#5", "pid of " + _service + " not set when started")

	_level = $(service sshd config get sftp_log_level)
	maybe_barf(_success, "+service#6", "unable to get sftp_log_level property of sshd service")
	@$(service sshd config set sftp_log_level=QUIET)
	maybe_barf(_success, "+service#7", "unable to set sftp_log_level property of sshd service")
	@$(service sshd config set sftp_log_level=${_level})
	maybe_barf(_success, "+service#8", "unable to restore sftp_log_level property of sshd service")
}

function service_destroy() {
	print(">>> Finishing service tests")
}
