# Common functions for all the tests

function maybe_barf(flag, test, str) {
	if (flag != true) {
	    printf("ERROR %s in %s\n", str, test)
	    fprintf(output_handle, "ERROR %s in %s\n", str, test)
	    if (_exit_on_error == "yes") {
		exit 1
	    }
	}
	return not flag
}

function maybe_die(flag, test, str) {
	if (flag != true) {
	    printf("FATAL error %s in %s\n", str, test)
	    fprintf(output_handle, "FATAL error %s in %s\n", str, test)
	    exit 2
	}
	return not flag
}	

# XXX Neither of these work yet; they require changes to the CLI

function find_by_name(where, name) {
	return $(${where} show | search name ~= ${name})
}

function count_by_name(where, name) {
	 _x = find_by_name(where, name)
	 # return length(_x)
	 return 0
}

function action_by_name(action, where, name) {
	 x = find_by_name(name, where)
	 if (x != null) {
	    for (i in x) {
	    	@$(${i["name"]} ${action})
	    }
	 }
}
