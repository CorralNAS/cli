# Test runner for vm category
#

# State variables shared between create and destroy functions.
_vm_name="vm_test_image"
_vm_object=none

function vm_create() {
	 print(">>> Starting vm tests")
	 _vm_object = @$(vm create name=${_vm_name} template=boot2docker volume=${VOL_NAME})
	 maybe_barf(_success, "+vm#1", "Unable to create VM " + _vm_name)
	 maybe_barf($(_vm_object get cores) == 1, "+vm#2", "Wrong number of cores returned for VM " + _vm_name)
	 @$(_vm_object set description="Test Description")
	 maybe_barf($(_vm_object get description) == "Test Description", "+vm#3", "Could not set description for " + _vm_name)
	 @$(_vm_object start)
	 maybe_barf(_success, "+vm#4", "Unable to start VM " + _vm_name)
	 @$(_vm_object stop)
	 maybe_barf(_success, "+vm#4", "Unable to stop VM " + _vm_name)
}

function vm_destroy() {
	 print(">>> Finishing vm tests")
	 _vm_object delete
	 maybe_barf(_success, "-vm#1", "Unable to delete VM " + _vm_name)
}


